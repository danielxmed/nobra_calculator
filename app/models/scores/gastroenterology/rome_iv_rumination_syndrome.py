"""
Rome IV Diagnostic Criteria for Rumination Syndrome Models

Request and response models for Rome IV rumination syndrome diagnostic assessment.

References (Vancouver style):
1. Stanghellini V, Chan FK, Hasler WL, Malagelada JR, Suzuki H, Tack J, Talley NJ. 
   Gastroduodenal disorders. Gastroenterology. 2016 May;150(6):1380-1392. 
   doi: 10.1053/j.gastro.2016.02.011.
2. Rome Foundation. Rome IV Diagnostic Criteria for Functional Gastrointestinal 
   Disorders. 4th ed. Raleigh, NC: Rome Foundation; 2016.
3. Barba E, Burri E, Accarino A, Cisternas D, Quiroga S, Monclus E, Navazo I, 
   Malagelada JR. Abdominothoracic mechanisms of functional abdominal distention 
   and correction by biofeedback. Gastroenterology. 2015 Apr;148(4):732-9. 
   doi: 10.1053/j.gastro.2014.12.006.
4. Kessing BF, Bredenoord AJ, Smout AJ. Objective manometric criteria for the 
   rumination syndrome. Am J Gastroenterol. 2014 Jan;109(1):52-9. 
   doi: 10.1038/ajg.2013.428.

CLINICAL BACKGROUND:

Rumination syndrome is a functional gastroduodenal disorder characterized by 
effortless regurgitation of recently ingested food into the mouth, followed by 
remastication and reswallowing or expulsion. This condition was historically 
considered rare and primarily affecting infants or individuals with intellectual 
disabilities, but recent recognition under the Rome IV criteria has revealed 
a prevalence of approximately 3.1% in the general adult population.

The pathophysiology involves learned voluntary intra-abdominal pressure increases 
through unconscious contraction of abdominal wall muscles against a closed glottis, 
creating a pressure gradient that forces gastric contents into the esophagus and 
mouth without the normal physiologic mechanisms of vomiting or retching. This 
process typically occurs within 30 minutes of eating and continues until the 
regurgitated material becomes acidic and unpalatable.

ROME IV DIAGNOSTIC CRITERIA:

The Rome IV criteria represent a paradigm shift in recognizing rumination syndrome 
as a legitimate functional gastrointestinal disorder in adults. The criteria require 
ALL of the following for ≥3 months with symptom onset ≥6 months before diagnosis:

POSITIVE CRITERIA (both required):
1. Persistent or recurrent regurgitation of recently ingested food into the mouth 
   with subsequent spitting or remastication and swallowing
2. Regurgitation is not preceded by retching (effortless regurgitation)

EXCLUSION CRITERIA (all must be absent):
3. No gastrointestinal bleeding (melena, hematemesis, hematochezia)
4. No unexplained iron deficiency anemia
5. No significant heartburn or esophageal reflux symptoms
6. No unintentional weight loss (>10% body weight over 6 months)
7. No palpable abdominal mass or lymphadenopathy
8. No dysphagia (difficulty swallowing solids or liquids)
9. No persistent vomiting episodes distinct from regurgitation

DIFFERENTIAL DIAGNOSIS:

Gastroesophageal Reflux Disease (GERD):
- Distinguished by presence of heartburn and acid reflux symptoms
- May have erosive esophagitis on endoscopy
- Responds to acid suppression therapy
- Regurgitation typically acidic and unpalatable

Gastroparesis:
- Associated with delayed gastric emptying
- Often accompanied by nausea, vomiting, and early satiety
- Gastric emptying study shows delayed emptying
- May be secondary to diabetes or other systemic conditions

Eating Disorders (Bulimia Nervosa):
- Intentional self-induced vomiting for weight control
- Associated with psychological distress and body image issues
- Often secretive behavior with guilt and shame
- May have dental erosion and electrolyte abnormalities

Achalasia:
- Primary esophageal motility disorder
- Progressive dysphagia for solids and liquids
- Chest pain and weight loss common
- Manometry shows impaired lower esophageal sphincter relaxation

Cyclic Vomiting Syndrome:
- Episodic, stereotypical vomiting episodes
- Symptom-free intervals between episodes
- Often associated with migraine headaches
- Typically begins in childhood or adolescence

CLINICAL CHARACTERISTICS:

Temporal Pattern:
- Regurgitation typically occurs within 10-30 minutes after eating
- Process continues until regurgitated material becomes acidic
- No regurgitation during sleep (nocturnal symptoms make diagnosis less likely)
- Symptoms may worsen with stress, anxiety, or specific foods

Physical Characteristics:
- Regurgitated material initially tastes pleasant (recognizable food)
- Material may be chewed again (remastication) before reswallowing or spitting
- No nausea, retching, or abdominal pain typically present
- Patients often describe the process as involuntary but effortless

Psychosocial Factors:
- Often associated with psychological stress or trauma
- May develop as a learned behavior in response to gastrointestinal symptoms
- Frequently misdiagnosed leading to patient frustration and anxiety
- Social embarrassment may lead to avoidance of eating in public

DIAGNOSTIC WORKUP:

History and Physical Examination:
- Detailed symptom characterization with temporal relationships to meals
- Assessment for alarm symptoms requiring organic evaluation
- Psychological assessment for underlying stressors or trauma
- Family history of gastrointestinal or psychological disorders

Laboratory Studies:
- Complete blood count to exclude iron deficiency anemia
- Comprehensive metabolic panel to assess nutritional status
- Consider vitamin B12, folate levels if nutritional deficiency suspected
- Inflammatory markers (ESR, CRP) if organic disease suspected

Upper Endoscopy:
- Indicated if alarm symptoms present or diagnosis uncertain
- Excludes erosive esophagitis, malignancy, or structural abnormalities
- Biopsy may be obtained to exclude eosinophilic esophagitis
- Generally normal in rumination syndrome

Gastric Emptying Study:
- May be performed to exclude gastroparesis if clinically suspected
- Typically normal in rumination syndrome
- Four-hour solid meal study is standard

Esophageal Manometry:
- Not routinely required for diagnosis
- May show characteristic pressure pattern during regurgitation episodes
- High-resolution manometry can document voluntary abdominal straining
- Useful to exclude primary esophageal motility disorders

TREATMENT APPROACH:

Behavioral Interventions (First-line):

Diaphragmatic Breathing Training:
- Primary treatment modality with 80-90% success rate
- Teaches patient to breathe with diaphragm rather than abdominal muscles
- Prevents unconscious abdominal contractions after meals
- Typically requires 3-6 sessions with trained therapist

Habit Reversal Therapy:
- Identifies triggers and teaches alternative behaviors
- Focuses on awareness of unconscious abdominal contractions
- Implements competing responses to interrupt regurgitation cycle
- Combines cognitive-behavioral techniques with motor skill training

Biofeedback Therapy:
- Uses real-time physiologic monitoring to teach muscle control
- Electromyography of abdominal muscles during training
- Visual or auditory feedback helps patients learn control
- Particularly effective when combined with breathing exercises

Dietary Modifications:

Meal Pattern Changes:
- Smaller, more frequent meals to reduce gastric volume
- Avoid large meals that may trigger regurgitation episodes
- Eating slowly with thorough chewing
- Remaining upright for 1-2 hours after meals

Food Texture Considerations:
- Some patients benefit from avoiding specific textures
- Liquids may be better tolerated than solids initially
- Gradual progression to normal diet as symptoms improve
- Avoid carbonated beverages that may increase gastric pressure

Psychological Support:

Stress Management:
- Address underlying psychological stressors when present
- Relaxation techniques and mindfulness training
- Cognitive-behavioral therapy for anxiety or depression
- Family counseling if psychosocial factors identified

Patient Education:
- Explanation of functional nature of condition
- Reassurance about benign prognosis with treatment
- Importance of adherence to behavioral interventions
- Setting realistic expectations for improvement timeline

PROGNOSIS AND FOLLOW-UP:

Treatment Response:
- 80-90% of patients respond to behavioral interventions
- Improvement typically seen within 2-8 weeks of consistent therapy
- Complete resolution possible in majority of motivated patients
- Relapse may occur during periods of stress requiring booster sessions

Long-term Outcomes:
- Generally excellent prognosis with appropriate treatment
- No increased risk of malignancy or serious complications
- Quality of life significantly improves with symptom resolution
- Maintenance of behavioral techniques important for sustained improvement

Follow-up Monitoring:
- Regular assessment of treatment adherence and response
- Monitoring for development of alarm symptoms
- Psychological support for adjustment and coping
- Coordination with gastroenterology and behavioral specialists as needed

SPECIAL CONSIDERATIONS:

Pediatric Populations:
- Similar diagnostic criteria apply to adolescents
- Often associated with developmental transitions or stressors
- Family involvement crucial for successful treatment
- School accommodation may be needed during treatment

Pregnancy Considerations:
- Symptoms may worsen during pregnancy due to increased intra-abdominal pressure
- Behavioral interventions remain first-line treatment
- No specific contraindications to standard therapies
- Close monitoring for nutritional adequacy important

Comorbid Conditions:
- May coexist with functional dyspepsia or irritable bowel syndrome
- Anxiety and depression common comorbidities
- Treatment should address all contributing factors
- Multidisciplinary approach often beneficial

This comprehensive assessment tool implements the internationally validated Rome IV 
diagnostic criteria to ensure accurate identification of rumination syndrome while 
systematically excluding organic pathology and alternative functional disorders.
"""

from pydantic import BaseModel, Field
from typing import Literal


class RomeIvRuminationSyndromeRequest(BaseModel):
    """
    Request model for Rome IV Diagnostic Criteria for Rumination Syndrome
    
    Rome IV diagnostic criteria for rumination syndrome require ALL of the following 
    for ≥3 months with symptom onset ≥6 months before diagnosis:
    
    POSITIVE CRITERIA (both required):
    1. Persistent or recurrent regurgitation of recently ingested food into the mouth 
       with subsequent spitting or remastication and swallowing
    2. Regurgitation is not preceded by retching (effortless regurgitation)
    
    EXCLUSION CRITERIA (all must be absent):
    3. No gastrointestinal bleeding
    4. No unexplained iron deficiency anemia  
    5. No significant heartburn or esophageal reflux symptoms
    6. No unintentional weight loss
    7. No palpable abdominal mass or lymphadenopathy
    8. No dysphagia
    9. No persistent vomiting episodes
    
    Clinical Characteristics of Rumination Syndrome:
    - Effortless regurgitation typically within 10-30 minutes after eating
    - Regurgitated material initially tastes pleasant (recognizable food)
    - May involve remastication before reswallowing or expulsion
    - Process continues until material becomes acidic and unpalatable
    - No nocturnal symptoms (makes diagnosis less likely if present)
    - Often associated with psychological stress or learned behavior
    - Distinguished from GERD by absence of heartburn and acid symptoms
    - Distinguished from gastroparesis by normal gastric emptying
    - Distinguished from eating disorders by involuntary nature
    
    Treatment primarily involves behavioral interventions:
    - Diaphragmatic breathing training (first-line, 80-90% success rate)
    - Habit reversal therapy and biofeedback
    - Dietary modifications (smaller meals, remaining upright after eating)
    - Psychological support for stress management
    
    References (Vancouver style):
    1. Stanghellini V, Chan FK, Hasler WL, Malagelada JR, Suzuki H, Tack J, Talley NJ. 
       Gastroduodenal disorders. Gastroenterology. 2016 May;150(6):1380-1392. 
       doi: 10.1053/j.gastro.2016.02.011.
    2. Rome Foundation. Rome IV Diagnostic Criteria for Functional Gastrointestinal 
       Disorders. 4th ed. Raleigh, NC: Rome Foundation; 2016.
    3. Barba E, Burri E, Accarino A, Cisternas D, Quiroga S, Monclus E, Navazo I, 
       Malagelada JR. Abdominothoracic mechanisms of functional abdominal distention 
       and correction by biofeedback. Gastroenterology. 2015 Apr;148(4):732-9. 
       doi: 10.1053/j.gastro.2014.12.006.
    4. Kessing BF, Bredenoord AJ, Smout AJ. Objective manometric criteria for the 
       rumination syndrome. Am J Gastroenterol. 2014 Jan;109(1):52-9. 
       doi: 10.1038/ajg.2013.428.
    """
    
    persistent_recurrent_regurgitation: Literal["yes", "no"] = Field(
        ...,
        description="Persistent or recurrent regurgitation of recently ingested food into the mouth "
                   "with subsequent spitting or remastication and swallowing for ≥3 months with "
                   "onset ≥6 months ago. This is the hallmark feature of rumination syndrome, "
                   "characterized by effortless bringing up of food that initially tastes pleasant "
                   "and recognizable. The regurgitated material may be chewed again (remastication) "
                   "before being reswallowed or expelled. This typically occurs within 10-30 minutes "
                   "after eating and continues until the material becomes acidic and unpalatable.",
        example="yes"
    )
    
    regurgitation_not_preceded_by_retching: Literal["yes", "no"] = Field(
        ...,
        description="Regurgitation is not preceded by retching (effortless regurgitation). "
                   "This criterion distinguishes rumination syndrome from vomiting disorders. "
                   "In rumination syndrome, the regurgitation occurs without the typical prodromal "
                   "symptoms of nausea, retching, or abdominal contractions seen in vomiting. "
                   "The process is effortless and often described as involuntary but without the "
                   "unpleasant sensations associated with gastroesophageal reflux or vomiting. "
                   "Patients may not even be fully aware when the regurgitation is occurring.",
        example="yes"
    )
    
    exclusion_gi_bleeding: Literal["yes", "no"] = Field(
        ...,
        description="Exclusion of signs of gastrointestinal bleeding. This includes absence of "
                   "melena (black, tarry stools), hematemesis (vomiting blood), hematochezia "
                   "(bright red blood in stool), or occult blood in stool. The presence of any "
                   "gastrointestinal bleeding would suggest organic pathology requiring immediate "
                   "evaluation including upper endoscopy, complete blood count, and assessment "
                   "for sources of bleeding. GI bleeding is inconsistent with functional rumination "
                   "syndrome and mandates investigation for structural abnormalities, malignancy, "
                   "or inflammatory conditions.",
        example="yes"
    )
    
    exclusion_iron_deficiency_anemia: Literal["yes", "no"] = Field(
        ...,
        description="Exclusion of unexplained iron deficiency anemia. Iron deficiency anemia "
                   "in the setting of regurgitation symptoms may indicate chronic gastrointestinal "
                   "blood loss, malabsorption, or dietary insufficiency that requires investigation. "
                   "Complete blood count with iron studies (serum iron, TIBC, ferritin) should be "
                   "normal or explained by non-gastrointestinal causes (e.g., menstrual losses, "
                   "dietary restrictions). Unexplained iron deficiency anemia warrants endoscopic "
                   "evaluation to exclude organic pathology including malignancy, inflammatory "
                   "bowel disease, or peptic ulcer disease.",
        example="yes"
    )
    
    exclusion_heartburn_reflux: Literal["yes", "no"] = Field(
        ...,
        description="Exclusion of significant heartburn or esophageal reflux symptoms. The presence "
                   "of typical GERD symptoms (heartburn, acid regurgitation, chest pain) suggests "
                   "gastroesophageal reflux disease rather than rumination syndrome. While patients "
                   "with rumination syndrome may have occasional mild reflux symptoms, significant "
                   "or predominant heartburn indicates GERD pathophysiology. GERD is characterized "
                   "by acidic regurgitation that tastes sour or bitter, occurs in supine position, "
                   "and responds to acid suppression therapy. This contrasts with rumination where "
                   "regurgitated material initially tastes pleasant and occurs postprandially.",
        example="yes"
    )
    
    exclusion_weight_loss: Literal["yes", "no"] = Field(
        ...,
        description="Exclusion of unintentional weight loss (typically defined as >10% of body "
                   "weight over 6 months or >5% over 3 months). Significant unintentional weight "
                   "loss in the context of regurgitation symptoms suggests serious underlying "
                   "pathology such as malignancy, inflammatory bowel disease, gastroparesis, or "
                   "eating disorders. Rumination syndrome typically does not cause significant "
                   "weight loss since much of the regurgitated food is reswallowed. Weight loss "
                   "warrants comprehensive evaluation including imaging studies, endoscopy, and "
                   "assessment for systemic diseases. Intentional weight loss or stable weight "
                   "does not exclude rumination syndrome diagnosis.",
        example="yes"
    )
    
    exclusion_abdominal_mass_lymphadenopathy: Literal["yes", "no"] = Field(
        ...,
        description="Exclusion of palpable abdominal mass or lymphadenopathy on physical examination. "
                   "The presence of abdominal masses may indicate malignancy, inflammatory conditions, "
                   "or other organic pathology requiring immediate investigation. Lymphadenopathy, "
                   "particularly in cervical, supraclavicular, or axillary regions, may suggest "
                   "systemic disease including malignancy or inflammatory conditions. Physical "
                   "examination should include careful palpation of the abdomen and lymph node "
                   "regions. Any palpable abnormalities warrant imaging studies (CT abdomen/pelvis) "
                   "and potential biopsy for tissue diagnosis. Normal physical examination supports "
                   "functional diagnosis of rumination syndrome.",
        example="yes"
    )
    
    exclusion_dysphagia: Literal["yes", "no"] = Field(
        ...,
        description="Exclusion of dysphagia (difficulty swallowing solids or liquids). Dysphagia "
                   "suggests structural or motility abnormalities of the esophagus requiring "
                   "evaluation with barium swallow and/or upper endoscopy. Oropharyngeal dysphagia "
                   "may indicate neurologic disorders, while esophageal dysphagia suggests "
                   "conditions such as achalasia, esophageal stricture, or malignancy. Progressive "
                   "dysphagia for solids then liquids suggests mechanical obstruction, while "
                   "dysphagia for both solids and liquids from onset suggests motility disorders. "
                   "True dysphagia is inconsistent with rumination syndrome where swallowing "
                   "function is typically normal.",
        example="yes"
    )
    
    exclusion_persistent_vomiting: Literal["yes", "no"] = Field(
        ...,
        description="Exclusion of persistent vomiting episodes distinct from regurgitation. "
                   "True vomiting involves forceful expulsion of gastric contents preceded by "
                   "nausea and retching, with autonomic symptoms such as pallor, diaphoresis, "
                   "and tachycardia. This contrasts with the effortless regurgitation seen in "
                   "rumination syndrome. Persistent vomiting suggests conditions such as "
                   "gastroparesis, cyclic vomiting syndrome, intestinal obstruction, or systemic "
                   "diseases. The presence of bile in vomitus indicates involvement beyond the "
                   "stomach. Persistent vomiting warrants evaluation with gastric emptying studies, "
                   "imaging, and metabolic assessment for electrolyte abnormalities and dehydration.",
        example="yes"
    )
    
    class Config:
        schema_extra = {
            "example": {
                "persistent_recurrent_regurgitation": "yes",
                "regurgitation_not_preceded_by_retching": "yes",
                "exclusion_gi_bleeding": "yes",
                "exclusion_iron_deficiency_anemia": "yes",
                "exclusion_heartburn_reflux": "yes",
                "exclusion_weight_loss": "yes",
                "exclusion_abdominal_mass_lymphadenopathy": "yes",
                "exclusion_dysphagia": "yes",
                "exclusion_persistent_vomiting": "yes"
            }
        }


class RomeIvRuminationSyndromeResponse(BaseModel):
    """
    Response model for Rome IV Diagnostic Criteria for Rumination Syndrome
    
    The Rome IV diagnostic criteria provide a systematic approach to diagnosing 
    rumination syndrome, a functional gastroduodenal disorder affecting approximately 
    3.1% of the general population. Accurate diagnosis requires fulfillment of ALL 
    criteria including 2 positive criteria and 7 exclusion criteria.
    
    Diagnostic Outcomes:
    
    POSITIVE DIAGNOSIS ("Criteria Met"):
    - All Rome IV criteria fulfilled
    - Both positive criteria present (persistent regurgitation with remastication, 
      effortless regurgitation without retching)
    - All 7 exclusion criteria satisfied (no alarm symptoms or organic causes)
    - Confirms functional rumination syndrome diagnosis
    - Indicates need for behavioral interventions as primary treatment
    
    NEGATIVE DIAGNOSIS ("Criteria Not Met"):
    - One or more criteria not fulfilled
    - May indicate presence of organic pathology requiring investigation
    - Consider alternative diagnoses (GERD, gastroparesis, eating disorders)
    - Further workup may be needed based on specific criteria not met
    
    Treatment Implications by Diagnosis:
    
    Positive Diagnosis Management:
    1. Behavioral Interventions (First-line):
       - Diaphragmatic breathing training (80-90% success rate)
       - Habit reversal therapy and biofeedback
       - Patient education about functional nature of condition
    
    2. Dietary Modifications:
       - Smaller, more frequent meals
       - Avoid large meals that trigger regurgitation
       - Remain upright for 1-2 hours after eating
       - Slow eating with thorough chewing
    
    3. Psychological Support:
       - Stress management and relaxation techniques
       - Cognitive-behavioral therapy if anxiety/depression present
       - Address underlying psychological stressors
    
    4. Follow-up Monitoring:
       - Regular assessment of treatment response
       - Reinforcement of behavioral techniques
       - Monitor for symptom resolution and quality of life improvement
    
    Negative Diagnosis Evaluation:
    1. Systematic Investigation:
       - Upper endoscopy if structural pathology suspected
       - Gastric emptying study if gastroparesis considered
       - Esophageal manometry if motility disorder suspected
       - Psychological evaluation if eating disorder suspected
    
    2. Alternative Diagnoses:
       - GERD with regurgitation (heartburn, acid symptoms, responds to PPI)
       - Gastroparesis (delayed gastric emptying, nausea, early satiety)
       - Eating disorders (intentional behavior, psychological distress)
       - Functional dyspepsia (postprandial distress, epigastric pain)
    
    3. Red Flag Symptoms Requiring Urgent Evaluation:
       - Gastrointestinal bleeding (melena, hematemesis, hematochezia)
       - Unintentional weight loss (>10% over 6 months)
       - Iron deficiency anemia (may indicate chronic blood loss)
       - Dysphagia (suggests structural or motility abnormality)
       - Palpable masses or lymphadenopathy (may indicate malignancy)
    
    Prognosis and Expected Outcomes:
    - Excellent prognosis with appropriate behavioral treatment (80-90% success rate)
    - Symptom improvement typically seen within 2-8 weeks
    - Complete resolution possible in majority of motivated patients
    - No increased risk of malignancy or serious complications
    - Quality of life significantly improves with successful treatment
    - Maintenance of behavioral techniques important for sustained improvement
    
    Reference: Stanghellini V, et al. Gastroenterology. 2016;150(6):1380-1392.
    """
    
    result: str = Field(
        ...,
        description="Rome IV diagnostic assessment result: 'Positive' if all criteria met, 'Negative' if criteria not fulfilled",
        example="Positive"
    )
    
    unit: str = Field(
        ...,
        description="Unit of measurement for the diagnostic assessment",
        example="diagnosis"
    )
    
    interpretation: str = Field(
        ...,
        description="Comprehensive clinical interpretation with diagnostic rationale and treatment recommendations based on criteria fulfillment",
        example="Patient fulfills Rome IV diagnostic criteria for rumination syndrome. Diagnosis is established when all criteria are met including persistent regurgitation of recently ingested food with remastication and reswallowing, effortless regurgitation without retching, and exclusion of organic causes. Treatment focuses on behavioral interventions including diaphragmatic breathing training, habit reversal therapy, and biofeedback. Dietary modifications and psychological support may be beneficial."
    )
    
    stage: str = Field(
        ...,
        description="Diagnostic stage classification (Criteria Met or Criteria Not Met)",
        example="Criteria Met"
    )
    
    stage_description: str = Field(
        ...,
        description="Brief description of the diagnostic stage",
        example="Meets Rome IV criteria"
    )
    
    class Config:
        schema_extra = {
            "example": {
                "result": "Positive",
                "unit": "diagnosis",
                "interpretation": "Patient fulfills Rome IV diagnostic criteria for rumination syndrome. Diagnosis is established when all criteria are met including persistent regurgitation of recently ingested food with remastication and reswallowing, effortless regurgitation without retching, and exclusion of organic causes. Treatment focuses on behavioral interventions including diaphragmatic breathing training, habit reversal therapy, and biofeedback. Dietary modifications and psychological support may be beneficial.",
                "stage": "Criteria Met",
                "stage_description": "Meets Rome IV criteria"
            }
        }